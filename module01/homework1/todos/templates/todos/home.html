{% extends 'todos/base.html' %}

{% block title %}TODO List{% endblock %}

{% block content %}
<div class="todo-form">
    <h2>Create New TODO</h2>
    <form method="post" action="{% url 'todo_create' %}">
        {% csrf_token %}
        <input type="text" name="title" placeholder="Title" required>
        <textarea name="description" placeholder="Description (optional)" rows="3"></textarea>
        <input type="date" name="due_date" placeholder="Due Date (optional)">
        <button type="submit" class="btn-primary">Add TODO</button>
    </form>
</div>

<h2>TODO List</h2>
{% if todos %}
    {% for todo in todos %}
    <div class="todo-item {% if todo.resolved %}resolved{% endif %}">
        <div class="todo-content">
            <h3>{{ todo.title }}</h3>
            {% if todo.description %}
                <p>{{ todo.description }}</p>
            {% endif %}
            {% if todo.due_date %}
                <p><strong>Due:</strong> {{ todo.due_date }}</p>
            {% endif %}
            <p><small>Created: {{ todo.created_at|date:"Y-m-d H:i" }}</small></p>
        </div>
        <div class="todo-actions">
            <form method="post" action="{% url 'todo_toggle' todo.pk %}" style="display: inline;">
                {% csrf_token %}
                <button type="submit" class="btn-success">
                    {% if todo.resolved %}Unresolve{% else %}Resolve{% endif %}
                </button>
            </form>
            <button onclick="showEditForm({{ todo.pk }})" class="btn-secondary">Edit</button>
            <form method="post" action="{% url 'todo_delete' todo.pk %}" style="display: inline;">
                {% csrf_token %}
                <button type="submit" class="btn-danger" onclick="return confirm('Are you sure?')">Delete</button>
            </form>
        </div>
    </div>
    <div id="edit-form-{{ todo.pk }}" style="display: none; background: white; padding: 20px; margin-bottom: 10px; border-radius: 5px;">
        <h3>Edit TODO</h3>
        <form method="post" action="{% url 'todo_update' todo.pk %}">
            {% csrf_token %}
            <input type="text" name="title" value="{{ todo.title }}" required>
            <textarea name="description" rows="3">{{ todo.description }}</textarea>
            <input type="date" name="due_date" value="{{ todo.due_date|date:'Y-m-d' }}">
            <button type="submit" class="btn-primary">Update</button>
            <button type="button" onclick="hideEditForm({{ todo.pk }})" class="btn-secondary">Cancel</button>
        </form>
    </div>
    {% endfor %}
{% else %}
    <p>No TODOs yet. Create one above!</p>
{% endif %}

<script>
function showEditForm(id) {
    document.getElementById('edit-form-' + id).style.display = 'block';
}
function hideEditForm(id) {
    document.getElementById('edit-form-' + id).style.display = 'none';
}
</script>
{% endblock %}
